{% extends "base.html" %}
{% block title %}Crea Ordine{% endblock %}

{% block content %}
  <style>
    .form-wrapper {
      max-width: 600px;
      margin: 40px auto;
      padding: 25px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }

    .form-wrapper h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    form label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.3rem;
      font-weight: 600;
    }

    form input, form select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 1rem;
    }

    .product-block {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 10px;
      border: 1px solid #ddd;
    }

    .product-block h4 {
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .product-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 8px;
    }

    .product-line label {
      flex: 1;
    }

    .product-line select,
    .product-line input[type="number"] {
      width: 80px;
    }

    button {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      background-color: #e74c3c;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      cursor: pointer;
    }

    button:hover {
      background-color: #c0392b;
    }
  </style>

  <div class="form-wrapper">
    <h2>Crea e Invia Ordine</h2>

    <form method="POST" action="{{ url_for('orders_bp.create_order') }}">
      <label for="supplier_id">Fornitore</label>
      <select name="supplier_id" id="supplier_id" onchange="showProducts()" required>
        <option value="">Seleziona Fornitore</option>
        {% for supplier in suppliers %}
          <option value="{{ supplier.id }}">{{ supplier.name }}</option>
        {% endfor %}
      </select>

      {% for supplier in suppliers %}
        <div class="product-block" id="products-{{ supplier.id }}" style="display: none;">
          <h4>Prodotti per {{ supplier.name }}</h4>
          {% for product in supplier.products %}
            <div class="product-line">
              <label>{{ product.name }} ({{ product.unit }})</label>
              <select name="product_{{ product.id }}">
                <option value="0">0</option>
                {% for i in range(1, 21) %}
                  <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
              </select>
              <input type="number" step="0.01" name="price_{{ product.id }}" placeholder="$" required>
            </div>
          {% endfor %}
        </div>
      {% endfor %}

      <label for="cc_email">CC (opzionale)</label>
      <input type="text" name="cc_email" id="cc_email" placeholder="Email in CC separate da virgola (opzionali)">

      <button type="submit">Invia Ordine</button>
    </form>
  </div>

  <script>
    function showProducts() {
      const supplierId = document.getElementById('supplier_id').value;
      const blocks = document.querySelectorAll('.product-block');
      blocks.forEach(block => block.style.display = 'none');

      if (supplierId) {
        const selectedBlock = document.getElementById('products-' + supplierId);
        if (selectedBlock) selectedBlock.style.display = 'block';
      }
    }
  </script>
{% endblock %}