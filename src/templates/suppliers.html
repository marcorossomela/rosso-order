{% extends "base.html" %} {% block title %}Fornitori e Prodotti{% endblock %}

{% block content %}

<h2 class="mb-4 text-center">Gestione Fornitori</h2><!-- Filtro di ricerca --><div class="text-center mb-4">
  <form method="GET" class="d-inline-block" style="max-width: 400px;">
    <div class="input-group">
      <input type="text" name="q" class="form-control" placeholder="Cerca per nome o email" value="{{ request.args.get('q', '') }}">
      <button class="btn btn-outline-danger" type="submit">Cerca</button>
    </div>
  </form>
</div><!-- Bottone per aprire il modal --><div class="text-center mb-3">
  <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#addSupplierModal">
    + Aggiungi Fornitore
  </button>
</div><!-- Lista fornitori e prodotti -->{% for supplier in suppliers %}

  <div class="mb-4 p-3 border rounded-4 shadow-sm">
    <h5>{{ supplier.name }}</h5>
    <p>Email: {{ supplier.email }} | Telefono: {{ supplier.phone }}</p><a href="{{ url_for('suppliers_bp.edit_supplier', supplier_id=supplier.id) }}" class="btn btn-outline-primary btn-sm me-2">
  Modifica
</a>
<a href="{{ url_for('suppliers_bp.delete_supplier', supplier_id=supplier.id) }}" class="btn btn-outline-danger btn-sm" onclick="return confirm('Sei sicuro di voler eliminare questo fornitore?')">
  Elimina
</a>

<div class="mt-3">
  <strong>Prodotti:</strong>
  <ul class="list-group mt-2">
    {% for product in supplier.products %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ product.name }} ({{ product.unit }})
        <a href="{{ url_for('suppliers_bp.edit_product', product_id=product.id) }}" class="btn btn-sm btn-outline-secondary">Modifica</a>
      </li>
    {% else %}
      <li class="list-group-item">Nessun prodotto associato.</li>
    {% endfor %}
  </ul>
</div>

  </div>
{% endfor %}<!-- Modal: Aggiungi Fornitore --><div class="modal fade" id="addSupplierModal" tabindex="-1" aria-labelledby="addSupplierModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content rounded-4 shadow-lg border-0">
      <form method="POST" action="{{ url_for('suppliers_bp.manage_suppliers_products') }}">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="addSupplierModalLabel">Aggiungi Nuovo Fornitore</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Chiudi"></button>
        </div>
        <div class="modal-body"><div class="mb-3">
        <label class="form-label">Nome Fornitore</label>
        <input type="text" class="form-control" name="name" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Email</label>
        <input type="email" class="form-control" name="email" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Telefono</label>
        <input type="text" class="form-control" name="phone" required>
      </div>

      <label class="form-label">Prodotti</label>
      <div id="products">
        <div class="row mb-2 product-row">
          <div class="col">
            <input type="text" name="product_name[]" class="form-control" placeholder="Nome Prodotto" required>
          </div>
          <div class="col">
            <input type="text" name="product_unit[]" class="form-control" placeholder="Unità (kg, ecc.)" required>
          </div>
          <div class="col-auto d-flex align-items-center">
            <button type="button" class="btn btn-outline-danger" onclick="removeRow(this)">X</button>
          </div>
        </div>
      </div>

      <button type="button" class="btn btn-outline-secondary mt-2" onclick="addProduct()">+ Aggiungi Prodotto</button>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annulla</button>
      <button type="submit" class="btn btn-danger">Salva Fornitore</button>
    </div>
  </form>
</div>

  </div>
</div><!-- Script JS --><script>
function addProduct() {
  const container = document.getElementById('products');
  const row = document.createElement('div');
  row.className = 'row mb-2 product-row';
  row.innerHTML = `
    <div class="col">
      <input type="text" name="product_name[]" class="form-control" placeholder="Nome Prodotto" required>
    </div>
    <div class="col">
      <input type="text" name="product_unit[]" class="form-control" placeholder="Unità (kg, ecc.)" required>
    </div>
    <div class="col-auto d-flex align-items-center">
      <button type="button" class="btn btn-outline-danger" onclick="removeRow(this)">X</button>
    </div>
  `;
  container.appendChild(row);
}

function removeRow(button) {
  button.closest('.product-row').remove();
}
</script>{% endblock %}

